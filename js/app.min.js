"use strict";function coffeeItem(){return{restrict:"E",replace:!0,scope:{coffee:"=",onClick:"&"},templateUrl:"app/js/coffeeItem.html",link:function(e,n,t){var a=n[0].offsetWidth;n.css("height",a+"px")}}}function coffeeMenu(){return{restrict:"E",templateUrl:"app/js/coffeeMenu.html",controller:"CoffeeMenuCtrl",controllerAs:"vm",scope:{}}}function CoffeeMenuCtrl(e,n,t,a){function r(){i(),n.$on("pantry:updated",i)}function i(){m.menuItems=a.getMenuItems()}function c(e){angular.isNumber(e)?e=m.menuItems[e-1]:angular.isObject(e)&&(m.selectedMenuItem=m.menuItems.indexOf(e)+1),e.isAvailable?o(e):m.orderStatus="Out of stock: "+e.menuLabel}function o(n){m.orderStatus="Dispensing: "+n.menuLabel,t(function(){m.orderStatus="",m.selectedMenuItem=null,e.$broadcast("menuItem:ordered",{orderedItem:n}),m.menuItems=a.getMenuItems()},1e3)}var m=this;m.orderStatus="",m.orderDrink=c,r()}function inventoryService(e){function n(){t(),l(),a()}function t(){angular.forEach(y,function(e){f[e.name]={}})}function a(){angular.forEach(y,function(e){d[e.name]=e.price})}function r(){return y}function i(){var e=[],n=["coffee","decaf coffee","caffe latte","caffe americano","caffe mocha","cappuccino"];return n.sort(),angular.forEach(n,function(n){var t=m(n);e.push({menuLabel:n,imageUrl:t.image,isAvailable:s(t),formattedPrice:o(t)})}),e}function c(){var e=[],n=[];return angular.forEach(f,function(e,t){n.push(t)}),n.sort(),angular.forEach(n,function(n){e.push({name:n,quantity:f[n].quantity})}),e}function o(n){var t=0;return angular.forEach(n.ingredients,function(e){t+=d[e.name]*e.quantity}),t=t.toFixed(2),e("currency")(t,"$",2)}function m(e){for(var n=[],t=0;t<p.length;t++)if(p[t].menuItem.toLowerCase()===e){n=p[t];break}return n}function s(e){for(var n=!0,t=0;t<e.ingredients.length;t++){var a=e.ingredients[t],r=f[a.name];if(r.quantity<a.quantity){n=!1;break}}return n}function u(e){var n=m(e);angular.forEach(n.ingredients,function(e){var n=f[e.name];n.quantity-=e.quantity})}function l(){angular.forEach(f,function(e){e.quantity=10})}var f={},d={},p=[{menuItem:"coffee",image:"images/coffee.png",ingredients:[{name:"coffee",key:1,quantity:3},{name:"sugar",key:2,quantity:1},{name:"cream",key:3,quantity:1}]},{menuItem:"decaf coffee",image:"images/coffee.png",ingredients:[{name:"decaf coffee",key:4,quantity:3},{name:"sugar",key:2,quantity:1},{name:"cream",key:3,quantity:1}]},{menuItem:"caffe latte",image:"images/latte.png",ingredients:[{name:"espresso",key:7,quantity:2},{name:"steamed milk",key:5,quantity:1}]},{menuItem:"caffe americano",image:"images/americano.png",ingredients:[{name:"espresso",key:7,quantity:3}]},{menuItem:"caffe mocha",image:"images/mocha.png",ingredients:[{name:"espresso",key:7,quantity:1},{name:"cocoa",key:8,quantity:1},{name:"steamed milk",key:5,quantity:1},{name:"whipped cream",key:9,quantity:1}]},{menuItem:"cappuccino",image:"images/cappuccino.png",ingredients:[{name:"espresso",key:7,quantity:2},{name:"steamed milk",key:5,quantity:1},{name:"foamed milk",key:6,quantity:1}]}],y=[{name:"coffee",key:1,price:.75},{name:"decaf coffee",key:2,price:.75},{name:"sugar",key:3,price:.25},{name:"cream",key:4,price:.25},{name:"steamed milk",key:5,price:.35},{name:"foamed milk",key:6,price:.35},{name:"espresso",key:7,price:1.1},{name:"cocoa",key:8,price:.9},{name:"whipped cream",key:9,price:1}];return n(),{getIngredientPrices:r,getMenuItems:i,getPantryItems:c,removeIngredientsFromPantry:u,restockPantry:l}}function pantry(){return{restrict:"E",scope:{},templateUrl:"app/js/pantry.html",controller:"PantryCtrl",controllerAs:"vm"}}function PantryCtrl(e,n,t){function a(){i(),n.$on("menuItem:ordered",i)}function r(){t.restockPantry(),i(),e.$broadcast("pantry:updated")}function i(e,n){n&&t.removeIngredientsFromPantry(n.orderedItem.menuLabel),c.pantry=t.getPantryItems()}var c=this;c.restock=r,a()}angular.module("baristaMatic",["baristaMatic.templates"]),angular.module("baristaMatic").directive("coffeeItem",coffeeItem),angular.module("baristaMatic").directive("coffeeMenu",coffeeMenu).controller("CoffeeMenuCtrl",CoffeeMenuCtrl),CoffeeMenuCtrl.$inject=["$rootScope","$scope","$timeout","inventoryService"],angular.module("baristaMatic").factory("inventoryService",inventoryService),inventoryService.$inject=["$filter"],angular.module("baristaMatic").directive("pantry",pantry).controller("PantryCtrl",PantryCtrl),PantryCtrl.$inject=["$rootScope","$scope","inventoryService"],angular.module("baristaMatic.templates",[]).run(["$templateCache",function(e){e.put("app/js/coffeeItem.html",'<button type="button" class="btn btn-default btn-primary text-center menu-item-btn"\n        ng-click="onClick(coffee)"\n        ng-disabled="!coffee.isAvailable">\n  <div class="menu-item-name">{{coffee.menuLabel}}</div>\n  <img class="menu-item-img" ng-src="{{coffee.imageUrl}}" />\n  <div class="menu-item-price">{{coffee.formattedPrice}}</div>\n</button>\n'),e.put("app/js/coffeeMenu.html",'<h2 class="subtitle">Menu</h2>\n\n<div class="row col-xs-12 menu-selection-container">\n  <form name="vm.menuSelectionForm" class="form-inline text-center">\n    <div class="form-group">\n      <label for="coffeeSelection">Enter selection:</label>\n      <input type="number" class="form-control inline"\n             id="coffee-menu-selection" name="coffeeSelection"\n             ng-model="vm.selectedMenuItem"\n             ng-pattern="/^[1-6]{1}$/"\n             min="1"\n             max="6" />\n      <button type="submit" class="btn btn-default btn-primary"\n              ng-disabled="!vm.selectedMenuItem"\n              ng-click="vm.orderDrink(vm.selectedMenuItem)">Order</button>\n    </div>\n    <div class="error"\n          ng-show="vm.menuSelectionForm.coffeeSelection.$invalid || vm.selectedItemError">\n      Invalid selection\n    </div>\n    <div class="order-status">{{vm.orderStatus}}</div>\n  </form>\n</div>\n\n<div class="row">\n  <div class="inline col-xs-6 col-sm-4"\n       ng-repeat="menuItem in vm.menuItems">\n    <span class="selection-number" ng-show="menuItem.isAvailable">{{$index + 1}}</span>\n    <coffee-item coffee="menuItem" on-click="vm.orderDrink(menuItem)"></coffee-item>\n  </div>\n</div>\n'),e.put("app/js/pantry.html",'<div class="row col-xs-12 text-center">\n  <h2>Inventory</h2>\n</div>\n\n<div class="row pantry-table-container">\n  <div class="col-xs-12 pantry-table ">\n    <div class="row pantry-table-header-row">\n      <div class="col-xs-7 pantry-ingredient">Ingredient</div>\n      <div class="col-xs-5 pantry-quantity">Remaining</div>\n    </div>\n    <div ng-repeat="pantryItem in vm.pantry" class="row pantry-table-data-row">\n      <div class="col-xs-7 pantry-ingredient">\n        {{pantryItem.name}}\n      </div>\n      <div class="col-xs-5 pantry-quantity">\n        {{pantryItem.quantity}}\n      </div>\n    </div>\n  </div>\n</div>\n\n<div class="row col-xs-12 text-center">\n  <button type="button" class="btn btn-default btn-primary restock-btn"\n          ng-click="vm.restock()">Restock Ingredients</button>\n</div>\n')}]);